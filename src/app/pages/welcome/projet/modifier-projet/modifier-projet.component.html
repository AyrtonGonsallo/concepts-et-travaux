<div>
    <h2>Gestion des Projets</h2>  

<div class="visite-box" *ngIf="project?.Visite">
      <div class="visite-title">Visite de technicien</div>
      <div>
        Payée le : {{ project?.Visite?.Date | date:'dd/MM/yyyy HH:mm:ss' }}
        {{ project?.Visite?.DateDeProgrammation ? (' - Programmée le : ' + (project?.Visite?.DateDeProgrammation | date:'dd/MM/yyyy HH:mm:ss')) : '' }}
        {{ project?.VisiteFaite ? '- effectuée' : '' }}
      </div>

     
      Programmer une date de visite<br>
      <nz-form-label [nzSpan]="6" >Date de la visite</nz-form-label>
      <nz-date-picker nzShowTime [(ngModel)]="date_de_programmation" [nzDisabledDate]="disableBeforeToday"></nz-date-picker><br>
      <button nz-button nzType="primary" (click)="add_visite_date()">valider</button><br>
      <nz-divider></nz-divider>
      <label nz-checkbox [(ngModel)]="notifier_le_client_que_la_visite_est_finie">Notifier le client que la visite a été effectuée</label><br>
      <button nz-button nzType="primary" (click)="add_visite_date()">valider</button>

      <br>
    </div>


    <form nz-form [formGroup]="validateForm" (ngSubmit)="submitForm()">
      
        <nz-form-item>
            <nz-form-label [nzSm]="6" [nzXs]="24"  nzFor="Status"  nzRequired >
                <span>Status</span>
            </nz-form-label>
            <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="remplissez ce champ">
                <nz-select id="StatusId" formControlName="Status"  nzPlaceHolder="Status" >
                    <nz-option *ngFor="let option of liste_des_status" [nzValue]="option" [nzLabel]="option"></nz-option>
                </nz-select>
            </nz-form-control>
        </nz-form-item>
        <nz-form-item>
            <nz-form-label [nzSm]="6" [nzXs]="24"  nzFor="Description"  nzRequired nzTooltipTitle="What do you want other to call you" >
                <span>Description</span>
            </nz-form-label>
            <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="votre Description!">
                <textarea rows="4" nz-input id="Description" formControlName="Description"></textarea>

            </nz-form-control>
        </nz-form-item>

        <nz-form-item>
            <nz-form-label [nzSm]="8" [nzXs]="24" >Date de début des travaux</nz-form-label>
            <nz-form-control [nzSm]="16" [nzXs]="24">
                <nz-date-picker formControlName="Date_de_debut_des_travaux"></nz-date-picker>
            </nz-form-control>
        </nz-form-item>

        <nz-form-item>
            <nz-form-label [nzSm]="8" [nzXs]="24" >Date de fin des travaux</nz-form-label>
            <nz-form-control [nzSm]="16" [nzXs]="24">
                <nz-date-picker formControlName="Date_de_fin_des_travaux"></nz-date-picker>
            </nz-form-control>
        </nz-form-item>
        <nz-form-item>
            <nz-form-label [nzSm]="8" [nzXs]="24" >Autoriser le paiement</nz-form-label>
            <nz-form-control [nzSm]="16" [nzXs]="24">
                <nz-switch formControlName="Valider"></nz-switch>
            </nz-form-control>
        </nz-form-item>

        <nz-form-item>
            <nz-form-label [nzSm]="6" [nzXs]="24"  nzFor="artisans"   nzTooltipTitle="What do you want other to call you" >
                <span>Artisans</span>
            </nz-form-label>
            <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="votre artisans!">
                <nz-select id="artisans" [(ngModel)]="multipleValue" [ngModelOptions]="{standalone: true}" [nzSize]="size" nzMode="multiple" nzPlaceHolder="Please select">
                    <nz-option *ngFor="let option of artisans" [nzLabel]="option.Nom + ' ' +option.Prenom" [nzValue]="option.Id"></nz-option>
                  </nz-select>
            </nz-form-control>
        
        </nz-form-item>
        <nz-form-item>
            <nz-form-label [nzSm]="6" [nzXs]="24"  nzFor="devis"  nzRequired nzTooltipTitle="What do you want other to call you" >
                <span>Devis</span>
            </nz-form-label>
            <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="votre devis!">
                <nz-select id="devis" [(ngModel)]="multipleValue2" [ngModelOptions]="{standalone: true}" [nzSize]="size" nzMode="multiple" nzPlaceHolder="Please select">
                    <nz-option *ngFor="let option of devis" [nzValue]="option.ID" [nzLabel]="'ID: '+option.ID + ' - Prix: ' +option.Prix+' €'"></nz-option>
                  </nz-select>
            </nz-form-control>
        
        </nz-form-item>
       

      
        <nz-form-item nz-row class="register-area">
        <nz-form-control [nzSpan]="14" [nzOffset]="6">
            <button nz-button nzType="primary">modifier</button>
        </nz-form-control>
        </nz-form-item>
    </form>


    <div class="visite-box">
      <div class="visite-title">Paiement</div>
      <nz-table #nzTable2 [nzData]="paiements" [nzShowPagination]="'false'" nzTableLayout="fixed" >
        <thead>
          <tr>
            
            <th>ID</th>
            <th>Type de paiement</th>
            <th>Type</th>
            <th>Montant</th>
            <th>Date</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          
            <tr *ngFor="let data of nzTable2.data">
              <td>{{ data.ID }}</td>
              <td>{{ data.TypeDePaiement }}  </td>
              <td>{{ data.Type }}</td>
              <td>{{ data.Montant }} € </td>
              <td>{{ data.Date | date:'dd/MM/yyyy HH:mm:ss'}}  </td>
              <td> 
                <button nz-button nzType="primary" class="negative-action mb-5"  title="supprimer"  nz-popconfirm
                nzPopconfirmTitle="Voulez-vous vraiment supprimer ce paiement ?"
                nzPopconfirmPlacement="bottom"
                (nzOnConfirm)="deletePaiement(data.ID)"
                (nzOnCancel)="cancel()" ><span nz-icon nzType="delete"></span></button>
              </td>
            </tr>
           
            
        </tbody>
      </nz-table>
      <br><br>
      <form nz-form [formGroup]="paiementForm" (ngSubmit)="submitpaiementForm()">
        <!-- Type de Paiement -->
        <nz-form-item>
          <nz-form-label [nzSpan]="5" nzRequired nzFor="TypeDePaiement">Type de Paiement</nz-form-label>
          <nz-form-control [nzSpan]="12" nzErrorTip="Veuillez sélectionner un type de paiement!">
            <nz-select id="TypeDePaiement" formControlName="TypeDePaiement" nzPlaceHolder="Sélectionner">
              <nz-option nzValue="virement" nzLabel="Virement"></nz-option>
              <nz-option nzValue="en ligne" nzLabel="En ligne"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      
        <!-- Type -->
        <nz-form-item>
          <nz-form-label [nzSpan]="5" nzRequired nzFor="Type">Type</nz-form-label>
          <nz-form-control [nzSpan]="12" nzErrorTip="Veuillez sélectionner un type!">
            <nz-select id="Type" formControlName="Type" nzPlaceHolder="Sélectionner">
              <nz-option nzValue="visite" nzLabel="Visite"></nz-option>
              <nz-option nzValue="acompte" nzLabel="Acompte"></nz-option>
              <nz-option nzValue="échéance" nzLabel="Échéance"></nz-option>
              <nz-option nzValue="solde final" nzLabel="Solde Final"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      
        <!-- Montant -->
        <nz-form-item>
          <nz-form-label [nzSpan]="5" nzRequired nzFor="Montant">Montant</nz-form-label>
          <nz-form-control [nzSpan]="12" nzErrorTip="Veuillez entrer un montant!">
            <nz-input-number id="Montant" formControlName="Montant"  ></nz-input-number> 
          </nz-form-control>
        </nz-form-item>
      
        
      
        <!-- Bouton de soumission -->
        <nz-form-item>
          <nz-form-control [nzSpan]="12" [nzOffset]="5">
            <button nz-button nzType="primary" [disabled]="paiementForm.invalid">Ajouter un paiement</button>
          </nz-form-control>
        </nz-form-item>
      </form>
      
      <br>
    </div>
</div>